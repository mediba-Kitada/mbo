# ネットワークの基礎*(主題109)

## 1 インターネットプロトコルの基礎
### IANA
- Internet Assigned Numbers Authority
- 以下を管理する団体
    - ウェルノウンポートとレジスタードポートの番号
    - TCP/UDPの区別
    - サービス名
### IPv4
### クラス
| クラス | 範囲                        | サブネットマスク |
|--------|-----------------------------|------------------|
| A      | 0.0.0.0 - 127.255.255.255   | 255.0.0.0        |
| B      | 128.0.0.0 - 191.255.255.255 | 255.255.0.0      |
| C      | 192.0.0.0 - 223.255.255.255 | 255.255.255.0    |
| D      | 224.0.0.0 - 239.255.255.255 |                  |
| E      | 240.0.0.0 - 255.255.255.255 |                  |
- クラスDは、マルチキャスト用のアドレス
#### プライベートアドレス
| クラス | 開始        | 終了            |
|--------|-------------|-----------------|
| A      | 10.0.0.0    | 10.255.255.255  |
| B      | 172.16.0.0  | 172.31.255.255  |
| C      | 192.168.0.0 | 192.168.255.255 |
### IPv6
- アドレスを128ビットで表現
- 16ビット(4桁)ずつコロンで区切る(計8ブロック)
- 各ブロックにある0は省略可能
- 連続した0000のブロックは一回に限り::に省略可能
- 340澗個のアドレスを利用可能
- アドレスの省略表記
- IPsec(暗号化通信)
- アドレス自動割り当て機能
- IPv4との互換性は無い
    - IPv4と直接通信することは出来ないが、デュアルスタックなでの相互運用の仕組みを利用して混在したネットワークを構築することが出来る
- ブロードキャスト機能が廃止され、一斉送信はマルチキャスト(特定グループ宛通信)で行われる
- クラス概念は無い
#### ユニキャストアドレス
- 1対1通信に利用出来る
##### 集約可能グローバルアドレス
- IANAによって管理、割り当てされる世界中で一意となるアドレス
##### リンクローカルアドレス
- ホスト間で一意となるアドレス
##### ユニークローカルアドレス
- IPv4でのプライベートアドレスに似た組織内で自由に使えるアドレス
#### マルチキャストアドレス
- マルチキャスト(グループ宛送信)の宛先となるアドレス
#### サブネットプレフィックス
- ユニキャスト時の前半64ビット
- サブネットを表す
#### インターフェイス識別子
- ユニキャスト時の後半64ビット
- ホストを表す
- データリンク層のアドレスを用いて自動生成される
### CIDR*(Classless Inter-Domain Routing)
- サイダー
- 任意の長さのサブネットマスクを利用すること
### ポート番号
- 16ビットで表現される
- 0 - 65535番まで利用出来る
### ウェルノウンポート
- 0 - 1023番まで予約されている(00 0000 0000 - 11 1111 1111)
| ポート番号 | プロトコル | 用途                   |
|------------|------------|------------------------|
| 20         | FTP        | ファイル転送(データ用) |
| 21         | FTP        | ファイル転送(制御用)   |
| 25         | SMTP       | 電子メール送信         |
| 53         | DNS        | 名前解決               |
| 110        | POP3       | 電子メール受信         |
| 143        | IMAP       | 電子メール受信         |
### レジスタードポート
- 1024 - 49151番(100 0000 0000 - 1011 1111 1111 1111)
- ベンダーやグループの申請により割り当てが可能なポート番号
### ダイナミックポート
- 49152- 65535番(1100 0000 0000 0000 - 1111 1111 1111 1111)
### コネクションレス型プロトコル
- 相手とのコネクションを事前に行わず、送りたいデータを一方的に送りつける通信方式
### /etc/services
- ポート番号とサービス名の対応を設定する
### ICMP
- IPのエラーメッセージや制御メッセージを転送するプロトコル

## 2 基本的なネットワーク構成
### ルーティングテーブル
- パケットが送信される際、参照されるネットワーク情報
#### Destination
- 宛先ネットワークアドレス
#### Gateway
- 宛先ネットワークへのゲートウェイ
#### Genmask
- 宛先ネットワークのサブネットマスク
#### Flags
- 状態フラグ
#### Iface
- 宛先ネットワークへの送信に使用するインターフェイス
### /etc/hostname
- ホスト名のみ記述する
- RedHatEnterpriseLinux(RHEL)7からDebian系と同様に利用されている
### /etc/host.conf
- 古いディストリビューションにおいて、名前解決の優先順位を指定するファイル
    - ```order hosts,bind```
### /etc/nsswitch.conf
- GNU Cライブラリが名前解決やサービス名解決の際の問い合わせ順序を指定するファイル
- filesで/etc/hostsを参照
- dnsでDNSサーバを参照
- ```getent```はこのファイルの情報の問い合わせを行うコマンド
    - ```getent passwd root```
### /etc/resolv.conf
- 名前解決に利用するDNSサーバの指定やドメインを指定するファイル
- nameserverでは、3つまでしか設定出来ない。上限変更の際は、ライブラリの再コンパイルが必要
- domainには自身の所属するドメイン名を記述
- searchは省略されうるドメイン名を列挙。最大6までしか設定出来ず、上限変更の際は、ライブラリの再コンパイルが必要
- domainとsearchはどちらかひとつしか設定出来ず、最後に記述されたものが有効となる
### iproute2
- ifconfig,route,arp,netstatなどの旧来のネットワーク関連コマンドを置き換えるために開発されたネットワークユーティリティ
- ipコマンドを含む
#### PBR(ポリシーベースルーティング)
- 宛先アドレス、送信元アドレス、UDP/TCPのプロトコル、ポート番号などを組み合わせより詳細にパケットの送信先を決定するルーティング方式
### ip
- loインターフェイスにサブネットマスク255.255.0.0のアドレス127.0.0.100を追加 ```ip addr add 127.0.0.100/16 dev lo```
- ルーティングテーブルの削除 ```ip route del 192.168.3.0/26 via 192.168.2.101 dev eth1```
    - via ゲートウェイアドレス
    - dev 出力インターフェイス
### /procs/sys/net/ipv4/ip_forward
- ファイルの内容を1とすると、パケットの転送を許可する
### /etc/hosts
- 名前解決に用いられるシンプルなテキストファイル
- 1行に1つのIPアドレスがあり、そのIPアドレスと続くホスト名とを関連付ている
### route
- デフォルトゲートウェイの削除
    - IPアドレスを指定 ```route del default gw 192.168.1.254```
    - IPアドレスを指定しない ```route del default```

## 3 基本的なネットワークの問題解決
## クライアント側のDNS設定
