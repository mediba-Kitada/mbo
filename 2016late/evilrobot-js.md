# Saddlerã§æ‚ªã„ãƒ­ãƒœãƒƒãƒˆ

## ã¯ã˜ã‚ã«

ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«ãŠã„ã¦ã€æŒ‡æ‘˜ã™ã‚‹ã¨ã„ã†ã¯å‹‡æ°—ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ãŒã„ã‚‹ã‚‚ã®ã§ã™ã€‚ç‰¹ã«æ–°ã—ã„è¨€èªã§ã®é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€è¶³ã‚Šãªã„ã‚‚ã®ã ã‚‰ã‘ãªã®ã§è‡ªå‹•åŒ–ã‚„çœåŠ›åŒ–ã¯ã¨ã¦ã‚‚é‡è¦ãªè¦ç´ ã«ãªã‚Šã¾ã™ã€‚
LEGOã«ã¯ã€[æ‚ªã„ãƒ­ãƒœãƒƒãƒˆ](https://www.lego.com/ja-jp/minifigures/characters/evil-robot-23fc8e61ce564d138e9a5d4d90e0254e)ã¨ã„ã†ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ãŒã„ã¾ã™ã€‚
ä»Šå›ã¯ã€é–‹ç™ºãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ‚ªã„ãƒ­ãƒœãƒƒãƒˆã€ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®éš›ã«æŒ‡æ‘˜äº‹é …ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã‚Œã‚‹botã«ã¤ã„ã¦ã€ã‚³ãƒ¼ãƒ‰ã‚’äº¤ãˆãªãŒã‚‰ç´¹ä»‹ã—ã¾ã™ã€‚

## ç”¨æ„ã™ã‚‹ã‚‚ã®

ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã¯ã€JavaScript(ES2015)ã¨ã—ã¾ã™ã€‚

[mediba-Kitada/evilbot-js: Saddlerã§æ‚ªã„ãƒ­ãƒœãƒƒãƒˆ](https://github.com/mediba-Kitada/evilbot-js)


### [GitHub](https://github.com)ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®ç®¡ç†ã¯ã€GitHubã§è¡Œã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚

### [TravisCI](https://travis-ci.com/)ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ

CIã¯ã€TravisCIã§è¡Œã†ã‚‚ã®ã¨ã—ã¾ã™ã€‚
[travis](https://github.com/travis-ci/travis.rb) gemã‚’ä½¿ã†ã¨CLIã§æ“ä½œå‡ºæ¥ã¾ã™ã€‚

### [Saddler](http://packsaddle.org/)

Saddlerã‚’CIç’°å¢ƒã§ç¨¼åƒã•ã›ã€ãƒªãƒ³ãƒˆçµæœã‚’æŒ‡æ‘˜äº‹é …ã¨ã—ã¦ã‚³ãƒ¡ãƒ³ãƒˆã«ãƒ‘ã‚¤ãƒ—ã•ã›ã¾ã™ã€‚

### [yarn](https://yarnpkg.com/)

ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†ã«ã¯ã€yarnã‚’ç”¨ã„ã¾ã™ã€‚

### [ESLint](http://eslint.org/)

ãƒªãƒ³ã‚¿ãƒ¼ã«ã¯ã€ESLintã‚’ç”¨ã„ã„ã¾ã™ã€‚

### [standardJS](http://standardjs.com/)

ã‚³ãƒ¼ãƒ‰è¦ç´„ã«ã¯ã€standardJSã‚’ç”¨ã„ã„ã¾ã™ã€‚
ESLintã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦è¨­å®šã—ã¦ã€ãƒªãƒ³ãƒˆã—ã¾ã™ã€‚

## æ‰‹é †

### ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç®¡ç†

yarnã‹ã‚ã„ã„ã‚„ãƒ¼ã‚“ã€‚

```
# åˆæœŸåŒ–
% yarn init
yarn init v0.20.3
question name (evilbot-js):
question version (1.0.0):
question description: Evil Bot in JavaScript
question entry point (index.js):
question repository url (git@mediba-github:mediba-kitada/evilbot-js.git):
question author: mediba-kitada <kitada@mediba.jp>
question license (MIT): none
success Saved package.json
âœ¨  Done in 101.25s.

# å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å°å…¥
% yarn add eslint standard eslint-config-standard
yarn add v0.20.3
warning evilbot-js@1.0.0: License should be a valid SPDX license expression
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
ä¸­ç•¥
warning evilbot-js@1.0.0: License should be a valid SPDX license expression
âœ¨  Done in 23.82s.
```

travisã¨Saddlerã‚‚Gemfileã§ç®¡ç†ã—ã¾ã™ã€‚
Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®šã¯å¿…é ˆã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€TravisCIã®ç’°å¢ƒ(2.2.5)ã«åˆã‚ã›ã¦ãŠãã¾ã™ã€‚

```
# Rubyã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³æŒ‡å®š
% rbenv install 2.2.5
ruby-build: use openssl from homebrew

% vi .ruby-version
2.2.5

# bundlerã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
% gem install bundle

# å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å°å…¥
% bundle init
% vi Gemfile

group :local do
  gem 'travis'
end

group :ci do
  gem 'checkstyle_filter-git' 
  gem 'saddler' 
  gem 'saddler-reporter-github'
end

# ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯travisã ã‘å¿…è¦ã¨ãªã‚‹
% bundle install --without ci --path ./vendor/bundle
```

### ãƒªãƒ³ã‚¿ãƒ¼ã®è¨­å®š

ESLintã‚’ãƒªãƒ³ã‚¿ãƒ¼ã¨ã—ã€standardJSã‚’ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã—ã¦è¨­å®šã—ã¾ã™ã€‚

```
# ESLintã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã€ç·¨é›†
% vi .eslintrc
{
  "extends": "standard"
}

# npm scriptsã«ç™»éŒ²
# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ã€checkstyleã‚’æŒ‡å®šã—ã¦ãŠã
% vi package.json
"scripts": {
  "lint": "eslint -f checkstyle"
},

# ã‚³ãƒãƒ³ãƒ‰ä¾‹
% yarn lint index.js
yarn lint v0.20.3
$ eslint -f checkstyle index.js
<?xml version="1.0" encoding="utf-8"?><checkstyle version="4.3"><file name="/Users/kitada/project/evilbot-js/evilbot-js/index.js"></file></checkstyle>
âœ¨  Done in 1.14s.
```

### JavaScriptã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç”¨æ„ã™ã‚‹

ä»Šå›ã¯ã€ãƒãƒ¼ãƒ ã®ãƒã‚¤ãƒ–ãƒ«ã¨ãªã£ã¦ã„ã‚‹[ã¯ã˜ã‚ã¦ã®JavaScript]() 14ç« ã‹ã‚‰ã‚µãƒ³ãƒ—ãƒ«ç”¨ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ‹å€Ÿã—ã¾ã™ã€‚
masterãƒ–ãƒ©ãƒ³ãƒã«ã¯ã€æ­£å¸¸ãª(æŒ‡æ‘˜äº‹é …ãŒç„¡ã„)çŠ¶æ…‹ã«ã—ã¦ãŠãã¾ã™ã€‚

### GitHub Access tokenã®å–å¾—

Machine Accountã¨ã—ã¦ç™»éŒ²ã—ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®tokenã‚’å–å¾—ã™ã¹ãã§ã™ãŒã€[å€‹äººã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®token](https://github.com/settings/tokens)ã‚’å–å¾—ã—ã¾ã™ã€‚

### TravisCIã®è¨­å®š

è©²å½“ã®ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã‚’CIã™ã‚‹ãŸã‚ã®è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚
travis gemã‚’ä½¿ã£ã¦CLIã§æ“ä½œã—ã¦ã„ãã¾ã™ã€‚

```
# ãƒ­ã‚°ã‚¤ãƒ³
% bundle exec travis login
We need your GitHub login to identify you.
This information will not be sent to Travis CI, only to api.github.com.
The password will not be displayed.

Try running with --github-token or --auto if you don't want to enter your password anyway.

Username: mediba-kitada

# æœ‰åŠ¹åŒ–
% bundle exec travis enable --org --repo mediba-Kitada/evilbot-js
mediba-Kitada/evilbot-js: enabled :)

# GitHub Access tokenã‚’æš—å·åŒ–ã—ã¦ç’°å¢ƒå¤‰æ•°ã«ç™»éŒ²
% bundle exec travis env set GITHUB_ACCESS_TOKEN hoge --org --repo mediba-Kitada/evilbot-js
[+] setting environment variable $GITHUB_ACCESS_TOKEN
# ç’°å¢ƒå¤‰æ•°ä¸€è¦§ã‚’ç¢ºèª
% bundle exec travis env list --org --repo mediba-Kitada/evilbot-js
# environment variables for mediba-Kitada/evilbot-js
GITHUB_ACCESS_TOKEN=[secure]
```

### TravisCIã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã™ã‚‹

ãƒªãƒã‚¸ãƒˆãƒªã®ç›´ä¸‹ã«CIã™ã‚‹ãŸã‚ã®yamlå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚
ãƒ“ãƒ«ãƒ‰å¯¾è±¡ã®è¨€èªã¯ã€Node.jsã¨ã—ã¦ãŠãã¾ã™ã€‚

```
# yamlãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
% bundle exec travis init node_js --org --repo mediba-Kitada/evilbot-js
.travis.yml file created!
mediba-Kitada/evilbot-js: enabled :)

# yamlãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ“ãƒ«ãƒ‰ã«å¿…è¦ãªå‡¦ç†ã‚’è¨˜è¿°
% vi .travis.yml

# è¨€èªã«Node.jsã‚’æŒ‡å®š
language: node_js

node_js:
- '0.11'
- '0.10'
# TravisCIã®ã‚³ãƒ³ãƒ†ãƒŠã«ã¯ã€shllow cloneã•ã‚Œã‚‹ã®ã§ã€diffã‚’å–ã‚‹ãŸã‚ã«ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã‚’æŒ‡å®šã—ã€fetchã—ã¦ãŠã
before_script:
  - TRAVIS_FROM_BRANCH="travis_from_branch"
  - git branch $TRAVIS_FROM_BRANCH
  - git checkout $TRAVIS_FROM_BRANCH
  - git fetch origin master
  - git checkout -qf FETCH_HEAD
  - git checkout master
  - git checkout $TRAVIS_FROM_BRANCH
# ãƒ“ãƒ«ãƒ‰æ™‚ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æŒ‡å®š(ä»Šå›ã¯ãƒªãƒ³ãƒˆã®ã¿)
script: yarn lint index.js
# ãƒ“ãƒ«ãƒ‰ã«å¤±æ•—ã—ãŸå ´åˆã®å‡¦ç†
after_failure:
  # CIç’°å¢ƒã§Saddlerã‚’ç¨¼åƒã•ã›ã‚‹
  - gem install bundle
  - bundle install --without local
  # git diffã®çµæœã‚’ãƒªãƒ³ãƒˆã—ã€checkstyleãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å‡ºåŠ›ã€SaddlerãŒãƒ‘ãƒ¼ã‚¹ã€Pull Requestã«ã‚³ãƒ¡ãƒ³ãƒˆ
  - git diff --name-only --diff-filter=ACMR master | grep js | xargs yarn lint | bundle exec checkstyle_filter-git diff master | bundle exec saddler report --require saddler/reporter/github --reporter Saddler::Reporter::Github::PullRequestReviewComment

# .travis.ymlã®ãƒªãƒ³ãƒˆ
% bundle exec travis lint
```

__diffå¯¾è±¡ã®ãƒ–ãƒ©ãƒ³ãƒã¯ã€origin/masterã¨ãªã£ã¦ã„ã¾ã™ãŒã€å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯TravisCIãŒç”¨æ„ã—ã¦ãã‚Œã¦ã„ã‚‹ç’°å¢ƒå¤‰æ•°ã‚’é§†ä½¿ã—ãªãŒã‚‰ã€å·®åˆ†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç‰¹å®šã™ã‚‹å‡¦ç†ãŒå¿…è¦ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚__


### ã‚³ãƒ¼ãƒ‰è¦ç´„ã«é•åã™ã‚‹Pull Requestã‚’æŠ•ã’ã‚‹


æŒ‡æ‘˜äº‹é …ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã—ã¦ãã‚Œã¦ã¾ã™ã­ã€‚

## ãŠã‚ã‚Šã«

ä»Šå›ã¯ã€é–‹ç™ºãƒãƒ¼ãƒ ãŒç§å«ã‚å…¨å“¡JavaScriptåˆå¿ƒè€…ã¨ã„ã†ç”·å‰ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã—ãŸã®ã§ã€è‡ªå‹•åŒ–ã‚„çœåŠ›åŒ–ã«ã¯ãã‚Œãªã‚Šã®ãƒªã‚½ãƒ¼ã‚¹ã‚’å‰²ãã¾ã—ãŸã€‚
Saddlerã®å°å…¥ã¯ã€é–‹ç™ºã®å¾ŒæœŸã«å®Ÿæ–½ã—ãŸã®ã§ã™ãŒã€ã‚‚ã†å°‘ã—æ—©ã„ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿæ–½å‡ºæ¥ã‚Œã°ã¨æ€ã„ã¾ã—ãŸã€‚
æˆ‘ã€…äººé¡ãŒè³ªã®é«˜ã„ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’è¡Œã†ãŸã‚ã«ã€æ©Ÿæ¢°ã«åƒã„ã¦ã‚‚ã‚‰ã†ã¹ãã§ã™ã­ã€‚

## å‚è€ƒ

[Travis CIã§textlintã®æŒ‡æ‘˜ã‚’Pull Requestã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ›¸ãè¾¼ã‚€ - Qiita](http://qiita.com/azu/items/c2305f3dded3fda968e0)
[git ãƒªãƒã‚¸ãƒˆãƒªã®æœ€æ–°ã®å±¥æ­´ã ã‘ã‚’å–å¾—ã™ã‚‹ shallow clone - Qiita](http://qiita.com/usamik26/items/7bfa61b31344206077fb)
[æ‚ªã„ãƒ­ãƒœãƒƒãƒˆ | è¾ºå¢ƒç¤¾ä¼šç ”ç©¶å®¤](http://youkoseki.tumblr.com/post/126911561050/bad-robots)
